const opacityTagAttribute = '_extension_opacity_tag'
const imageTagAttribute = '_extension_image_tag'
const image2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAkCAMAAABIZG8KAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAxFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDc5LjE2NDQ2MCwgMjAyMC8wNS8xMi0xNjowNDoxNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjE5RkRGRkRGNjAxMTFFQUJEOEZBOEYxNzI3RTBGOEIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MjE5RkRGRkNGNjAxMTFFQUJEOEZBOEYxNzI3RTBGOEIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIwMjAgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJBNkFENzM1MkVDMUQwMzRFOENDQzg3NjVCMkYwRjVEQSIgc3RSZWY6ZG9jdW1lbnRJRD0iQTZBRDczNTJFQzFEMDM0RThDQ0M4NzY1QjJGMEY1REEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4zfZbAAAADAFBMVEWFNijFx8butaQ3NTrGVjpqPzy6xMmmkZFlZWeIhYXqj3RVWmNtZlacpq1YV1qCd3P9/Px4eXs2OEPO2Od9g4jsp5WmQypFSlbKRSGpPCSzPSNaODe3V0PYxcGNgmfldlaJUke1SjJLODzUSiPVUS3Ilo714dzZaEfLXkHRTirDRCKYRTTEPBmoVEQnJiz19PVze4Jma3H21MrLTCvLRB5EO0KXnaTxwbWoSTW6q6YrKzI8QErn2NZkWlV5NCmjqa27UTloOTS4h6OrsrmhoqS8QiTRUzJocnu7vb7DTjS1vsJ4OzJbYWvlx8PUXT55amqytLRBRE15dGS2urukqoOzOx3r6utpNC3SRR7X19amrbC8Qxj79fOoZ1OZiIe0alfNSSWam52ipaj0zcNgudCMk5jESi2qOB/05uSIjJCXe4dbRkWxQytVKSTFQR9NU1vj4+O8x6GLMR6LY16MRTiTlJnCv74uMTydPSq+Ph7b5OqHPDC1QiXWtKzBRChnSEW4ORm6RS2XQTCTk5JNS03YzMcyLzO1sarZ0dHG0t65fW2+OhjFy9GrrK1Wb1GTPSt4RUDunITu4uHdvrjHqq6sUj706ulZVU+bOiX87upDQEOUOSXYTStIKivk0c65PR+WmJu+PBraTSNiX1+dkYj729HO0MzarqdMRErLu62vt7q7OBdxWlrEXkraVDG+SS7CdmW5OhysrKSob1sbGyM6Ki/Qqp728O6mXU/75N5qU1FzkKBcMi/eUyueNiC1uLc2HR7MUC9OQUOQj5KqpqNxUUliKyC5YU2aNii6trFBMDadl5VwMCS8OhuSNCO5uLdQTlOdQC9QMTPJSCloTU7PRiC6NRBGIhrBd2i7PRtGR0wSEx6mqKjRWTUdHya7NhrFRyfGTRfVTC7DcF3ac1bw8PH77+/e4tr8+PfWlbbgWjHnkLfCzJd4x9pRYEueUEK/RydzTU1kf1TUVjZycXSrnJuex8q7cFxDS0bqgmTBa1bfb0+mYlPx6ej76+b///9DwfD2AAABAHRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AU/cHJQAAC11JREFUeNqslw9Y0ncex3+GGh6K+pOBAttScRM0lBBmPxJ1CmiyFB2xrAxtSqRC11JkkMPicKaeZvN0aKmxlaXpuWnrj2nkVs2kocbtZNacd23d7m5Z0a1d7bjvT7vd9jzXc8+eu/fz/f54+MLn8/p8P9+/P8j9vykgIODWpi+bmr5sOvT06dP/OP3uu6teWLZ11dZVq57bFPCvP0H/2TBg0RhYv/3c219uW/PcaeBg22nUBdDWrS+gWrZs2VNP7d+//xffffcs0MOHoDz//PPr1q2LBCXy4f6tP0ACtgGjrS8tGj0FrB4L2D42fvbhH4H1w0UHiz5QF9c9PZM8qZ5UanNzPKrJPUBRDQ06HZQBKpQB6TKo+3a4Y2JiUMi2P1y6tJK6snnlom6D+ujR7dtRKxoX5dXo5eUV1ehFQXUh7EJYWMau8fFx0zhmUZqweGJ8fEl8CVBVSWhVf2V/EqhzRUXskinKHQKrTIxTrndDh6jAMRpPUjO1OYkKlASU7gXzJDweT0IikSSNxWqW2JKQcKa3t9denAE77XZ7t7PFjsXiOaF9fX209vb28Pb5cPo8XdjeNz/fPg/q5DC/mOCXA8Mb6t3QSyfQ/t8DWvdYfX1CoZCC7ewsc+EDCYRAV3HCWA3X59tTjzZv/tbfQsEH1tXt9TW2sDzq8uHQvnvCe1RPa3oRmz1Pp7Mnd+l0ugwgytDUcNna1DFRzOgtADkRGUld1KlHK+Nvg1RFWa9bKaJcJTeVUPDeLFd5LXN2rd+VLY8AZMs7PsPixKCgtX/BEzbkcNN8kimUqbAwkMFxXTud3q7TwBq0aGAJb0j22nHlhh05sRugAyci11G7YQ5Hw+PAiz/DnHQa7Q0WN7bzk7GsnKzE1GuZucePZ+17//3N7++74jPMSgkK8njZ6POVd4pHdpjGyWLhLUYYARAajcLjwRq0wnY1ZrjRr7CwTsOKgQ54enpSu7dvF/lxJRpcWkphbj6ACCnKnMSc8rKcuvLRXBQymlZenlad+mHK8uGCuqDXj/wSP5bF9fa2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'
const image3 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAA8CAMAAACn4e/8AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDc5LjE2NDQ2MCwgMjAyMC8wNS8xMi0xNjowNDoxNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI5M0M5QTc0RjYwMTExRUFBODJDODlDMzk3ODEzRkEwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI5M0M5QTc1RjYwMTExRUFBODJDODlDMzk3ODEzRkEwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjkzQzlBNzJGNjAxMTFFQUE4MkM4OUMzOTc4MTNGQTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MjkzQzlBNzNGNjAxMTFFQUE4MkM4OUMzOTc4MTNGQTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6hzSukAAADAFBMVEXCpKG7pKTjxcPnvbjlystKNjPz29yjjIvTtLLqzMq2kYqznJvUq6WycG67nZnJqaXjvsLDrKyrk5Lxzcb29vbTu707JySmgnqyi4iDbWvNsrHCop2ZgH2HY1zUsq4qGRfcwsPrycPaubN5YV2cg4KKdXOTfXzIxMT9/f3s6+vnu6zkwr6rkI11XVp7ZGH41syrioS6tLWggX2ylJHy1NXk4uLc2drWp5xoUU5BLCirjYmIcG61mJO7oJ6TW0ratLLoxMFTPTrJsLD6+vpIMS1rVVL2yrqihoL96+taREGUc2zatayaenRwRj/dwL9jTUq3mpf45OTnzdC2oaFWQD45FRKbfXiVgYHrxLp8d3eei4rp5ubHpqH14OGUeXaKbGaVa2SspaX13d/BtLMZCwyOe3vBvLyCambAnZqMhYTYvr9QOTbWwcPIra3d1tX729PAmpVmUlFyWVbWt7Xix8mmiYbJl4iObmnu1NjDqKblyMd+amnt1tZjSUSEc3LNpJy6lpDp0NFuWlm+qqrZube1rK3n0NLu09XNramumprW1NTLvbzYrrF9X1l2Y2Lh3d2lkJDEiYWPdHH64t9rOy40IR7fvrrStrick5PUl5bOr63JrKl3V0/y2Nb63tz75uhUREPJqqjuz81sV1V8W1RgS0irhYHu0dCln5/Oysrbvr2fiIbZvLq6fn/Uz87x7e7Km5XLqKDLr7FeSEV+Z2TUsKjtw8fdxMfu2NqASTxdNCZoZWVxVlFOQUHFpqdRNTDcsqNiRUDp09Wtl5WQiolkXFxpTEZXKyaCZl/tyL7DkpPbtrjFfndoT0rNmZ5WOTPPpacsJifv1NOKaGP019jOtLbOqqZBMzPdubVZPjqkj45OPj6plZabhodCJyGNd3br1dT419RyUUp1YF6beHK/r66/n5/x8PCimJmmmJeBfX1GGxHOx8ferZx4b296Z2b+8PBfT0/Hn5jOn47Y1te5l5bfuLxXSEZPSUnlv7adaFjJrK49ISBZNTOZjY////8xA/yyAAABAHRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AU/cHJQAADUNJREFUeNqs13lYU1faAPCbmBCS2IQtl4RE1iRGSCISwaxK5MYYohAgDRYiuCSARFQCDAJCIbiAGqBowELd2KxCFwgITqkU6ThYh4JVBCmLNYjz9bOiVsexMnUuT+d5Zr6u08+cP/JHTp787vuee877HuDl7xusX5u8t48U/HPfA7/PKN8R8isPcOjMeWLYqyOdZ6IWh/3CXPyh8wtWfLjj1ZGzQz5r39/xczljJd08f37B2285vzriRl61/OGRu8E/joa1pHiB0/nz59/+S9qrIyzeYaczWx4q2VvLl7i5hbkFb717f0fIwUOSjgWHnZwOv/3WX9peHXlZPPS36N11X214nJLCC68UuodPk92vjq7aELDQaTfq8/deey/HDkjwZzASHeoT0OF51b1JeKfXHBg4GrBhaejVq6iuzPdeew1hB4Q1E+0Q7Z0Z6hrgdBWnCWpouA5sanVydT2/auhw22E4lBA7IC8PDc2kEF5UbQgNvTndQM3OJgvXE5VX6upCnZz+Vj30+Vtu9kA+IFy8+IJ0brQqQNt0GWjS3Ly+aHSB61c3lm9x2B3t9BnOLkj804uk/ZdQyKqAqtHw/qfktEFcKLZu+Y0bMLKL/Plh+yApTcNdB1C5uUhsaEsiIQVoOuNTtxweN26ghj5bsco+yGdNp6OLUCjsxlziAZ4msDDl5GOsQ91yhy1blmOHhrR2Qcpx7oA3tgg5GhXh7vBYM01ufUiuOrn8SFRUlMOJ0Q+pdkGCA3EZmV/sKfKJQuFuKHftetNn7ajP8VXIqJMbj0SddPW9Zw9kMdEXmVt0/JzW84tRnwDlwg4f169urty0fpPribUnThzxibcHshV+rXKRu45eaFjZEdChVD4f9XE8+kfphfULHmtP1O2ss8tmvF+l9A0UNx1d6XX0wt4qpf8G17XhRxukKzd9hcINudZh7YLEZyhViR4d678zf/e/7Lrna3YeeWh+feV3F4Z2OqCmR7HYHXZBamrYGbmuuKMX/vhnd1d/1507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'

chrome.runtime.onMessage.addListener(function (request) {
  // Opacity
  if (request.setShadowOpacity) {
    _setOpacity(request.setShadowOpacity)
  }

  // Image
  if (request.setImage) {
    _setImage(request.setImage)
  }
})

chrome.runtime.sendMessage({ getData: true }, response => {
  console.log(response.data)
  if (response.data.opacity) {
    _setOpacity(response.data.opacity)
  }
  if (response.data.image) {
    _setImage(response.data.image)
  }
})

function _createExtensionTag (tagAttribute, stylesText) {
  const $head = document.querySelector('head')

  // Remove existing tags
  $head.querySelectorAll(`[${tagAttribute}]`).forEach($tag => $head.removeChild($tag))

  // Add a new one
  const styleTag = document.createElement('style')
  styleTag.setAttribute(tagAttribute, true)
  styleTag.appendChild(document.createTextNode(stylesText))
  $head.appendChild(styleTag)
}

function _setOpacity (shadowOpacity) {
  const $head = document.querySelector('head')

  // Remove existing tags
  $head.querySelectorAll(`[${opacityTagAttribute}]`).forEach($tag => $head.removeChild($tag))

  // Add new one
  _createExtensionTag(opacityTagAttribute, `.back { opacity: ${shadowOpacity} !important; }`)
}

function _setImage (imageNumber) {
  const $head = document.querySelector('head')
  const stylesText = imageUrl => `.you .car .img { background-image: url("${imageUrl}"); background-size: contain; background-repeat: no-repeat; background-color: #fff; background-position: 50% 50%;`
  switch (imageNumber) {
    case 1:
      // Remove existing tags
      $head.querySelectorAll(`[${imageTagAttribute}]`).forEach($tag => $head.removeChild($tag))
      break
    case 2:
      _createExtensionTag(imageTagAttribute, stylesText(image2))
      break
    case 3:
      _createExtensionTag(imageTagAttribute, stylesText(image3))
      break
  }
}
